{"version":3,"sources":["../../src/tracking/index.ts","../../src/tracking/analytics.ts","../../src/tracking/pixel.ts"],"sourcesContent":["export {\n  initializeAnalytics,\n  trackPageView,\n  trackViewItem,\n  trackAddToCart,\n  trackRemoveFromCart,\n  trackBeginCheckout,\n  trackPurchase,\n  trackEvent,\n  type AnalyticsConfig,\n  type EcommerceItem,\n} from './analytics'\n\nexport {\n  initializePixel,\n  trackPixelPageView,\n  trackPixelProductView,\n  trackPixelAddToCart,\n  trackPixelCheckoutStart,\n  trackPixelPurchase,\n  trackPixelCustomEvent,\n} from './pixel'\n","/**\n * Analytics and tracking utilities\n *\n * Supports GA4, Meta Pixel, and Microsoft Clarity\n */\n\ndeclare global {\n  interface Window {\n    gtag?: (...args: unknown[]) => void\n    fbq?: (...args: unknown[]) => void\n    clarity?: (...args: unknown[]) => void\n  }\n}\n\nexport interface AnalyticsConfig {\n  ga4Id?: string\n  metaPixelId?: string\n  clarityId?: string\n}\n\nexport interface EcommerceItem {\n  item_id: string\n  item_name: string\n  item_brand?: string\n  item_category?: string\n  item_variant?: string\n  price: number\n  quantity: number\n}\n\n/**\n * Initialize analytics scripts\n */\nexport function initializeAnalytics(config: AnalyticsConfig): void {\n  if (typeof window === 'undefined') return\n\n  // GA4\n  if (config.ga4Id && !window.gtag) {\n    const script = document.createElement('script')\n    script.src = `https://www.googletagmanager.com/gtag/js?id=${config.ga4Id}`\n    script.async = true\n    document.head.appendChild(script)\n\n    window.gtag = function () {\n      // eslint-disable-next-line prefer-rest-params\n      ;(window as { dataLayer?: unknown[] }).dataLayer =\n        (window as { dataLayer?: unknown[] }).dataLayer || []\n      // eslint-disable-next-line prefer-rest-params\n      ;(window as { dataLayer?: unknown[] }).dataLayer!.push(arguments)\n    }\n    window.gtag('js', new Date())\n    window.gtag('config', config.ga4Id)\n  }\n\n  // Meta Pixel\n  if (config.metaPixelId && !window.fbq) {\n    const script = document.createElement('script')\n    script.innerHTML = `\n      !function(f,b,e,v,n,t,s)\n      {if(f.fbq)return;n=f.fbq=function(){n.callMethod?\n      n.callMethod.apply(n,arguments):n.queue.push(arguments)};\n      if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';\n      n.queue=[];t=b.createElement(e);t.async=!0;\n      t.src=v;s=b.getElementsByTagName(e)[0];\n      s.parentNode.insertBefore(t,s)}(window, document,'script',\n      'https://connect.facebook.net/en_US/fbevents.js');\n      fbq('init', '${config.metaPixelId}');\n      fbq('track', 'PageView');\n    `\n    document.head.appendChild(script)\n  }\n\n  // Microsoft Clarity\n  if (config.clarityId && !window.clarity) {\n    const script = document.createElement('script')\n    script.innerHTML = `\n      (function(c,l,a,r,i,t,y){\n        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};\n        t=l.createElement(r);t.async=1;t.src=\"https://www.clarity.ms/tag/\"+i;\n        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);\n      })(window, document, \"clarity\", \"script\", \"${config.clarityId}\");\n    `\n    document.head.appendChild(script)\n  }\n}\n\n/**\n * Track page view\n */\nexport function trackPageView(pagePath: string, pageTitle?: string): void {\n  if (typeof window === 'undefined') return\n\n  // GA4\n  window.gtag?.('event', 'page_view', {\n    page_path: pagePath,\n    page_title: pageTitle,\n  })\n\n  // Meta Pixel\n  window.fbq?.('track', 'PageView')\n}\n\n/**\n * Track product view\n */\nexport function trackViewItem(item: EcommerceItem): void {\n  if (typeof window === 'undefined') return\n\n  // GA4\n  window.gtag?.('event', 'view_item', {\n    currency: 'USD',\n    value: item.price,\n    items: [item],\n  })\n\n  // Meta Pixel\n  window.fbq?.('track', 'ViewContent', {\n    content_ids: [item.item_id],\n    content_name: item.item_name,\n    content_type: 'product',\n    value: item.price,\n    currency: 'USD',\n  })\n}\n\n/**\n * Track add to cart\n */\nexport function trackAddToCart(item: EcommerceItem): void {\n  if (typeof window === 'undefined') return\n\n  // GA4\n  window.gtag?.('event', 'add_to_cart', {\n    currency: 'USD',\n    value: item.price * item.quantity,\n    items: [item],\n  })\n\n  // Meta Pixel\n  window.fbq?.('track', 'AddToCart', {\n    content_ids: [item.item_id],\n    content_name: item.item_name,\n    content_type: 'product',\n    value: item.price * item.quantity,\n    currency: 'USD',\n  })\n}\n\n/**\n * Track remove from cart\n */\nexport function trackRemoveFromCart(item: EcommerceItem): void {\n  if (typeof window === 'undefined') return\n\n  // GA4\n  window.gtag?.('event', 'remove_from_cart', {\n    currency: 'USD',\n    value: item.price * item.quantity,\n    items: [item],\n  })\n}\n\n/**\n * Track begin checkout\n */\nexport function trackBeginCheckout(items: EcommerceItem[], value: number): void {\n  if (typeof window === 'undefined') return\n\n  // GA4\n  window.gtag?.('event', 'begin_checkout', {\n    currency: 'USD',\n    value,\n    items,\n  })\n\n  // Meta Pixel\n  window.fbq?.('track', 'InitiateCheckout', {\n    content_ids: items.map((i) => i.item_id),\n    num_items: items.reduce((sum, i) => sum + i.quantity, 0),\n    value,\n    currency: 'USD',\n  })\n}\n\n/**\n * Track purchase\n */\nexport function trackPurchase(\n  transactionId: string,\n  items: EcommerceItem[],\n  value: number\n): void {\n  if (typeof window === 'undefined') return\n\n  // GA4\n  window.gtag?.('event', 'purchase', {\n    transaction_id: transactionId,\n    currency: 'USD',\n    value,\n    items,\n  })\n\n  // Meta Pixel\n  window.fbq?.('track', 'Purchase', {\n    content_ids: items.map((i) => i.item_id),\n    content_type: 'product',\n    num_items: items.reduce((sum, i) => sum + i.quantity, 0),\n    value,\n    currency: 'USD',\n  })\n}\n\n/**\n * Track custom event\n */\nexport function trackEvent(\n  eventName: string,\n  params?: Record<string, unknown>\n): void {\n  if (typeof window === 'undefined') return\n\n  // GA4\n  window.gtag?.('event', eventName, params)\n}\n","/**\n * Attribution pixel for tracking conversions across platforms\n */\n\ninterface PixelConfig {\n  platformUrl: string\n  brandId: string\n}\n\ninterface AttributionData {\n  event: string\n  value?: number\n  currency?: string\n  orderId?: string\n  items?: Array<{\n    id: string\n    name: string\n    price: number\n    quantity: number\n  }>\n  metadata?: Record<string, unknown>\n}\n\nlet pixelConfig: PixelConfig | null = null\n\n/**\n * Initialize the attribution pixel\n */\nexport function initializePixel(config: PixelConfig): void {\n  pixelConfig = config\n\n  // Load tracking script\n  if (typeof window !== 'undefined') {\n    const script = document.createElement('script')\n    script.src = `${config.platformUrl}/pixel.js`\n    script.async = true\n    script.dataset.brandId = config.brandId\n    document.head.appendChild(script)\n  }\n}\n\n/**\n * Track a page view\n */\nexport function trackPixelPageView(path?: string): void {\n  if (typeof window === 'undefined' || !pixelConfig) return\n\n  sendPixelEvent({\n    event: 'page_view',\n    metadata: {\n      path: path || window.location.pathname,\n      referrer: document.referrer,\n      url: window.location.href,\n    },\n  })\n}\n\n/**\n * Track a product view\n */\nexport function trackPixelProductView(\n  productId: string,\n  productName: string,\n  price?: number\n): void {\n  sendPixelEvent({\n    event: 'view_item',\n    value: price,\n    items: [\n      {\n        id: productId,\n        name: productName,\n        price: price || 0,\n        quantity: 1,\n      },\n    ],\n  })\n}\n\n/**\n * Track add to cart\n */\nexport function trackPixelAddToCart(\n  productId: string,\n  productName: string,\n  price: number,\n  quantity: number\n): void {\n  sendPixelEvent({\n    event: 'add_to_cart',\n    value: price * quantity,\n    items: [\n      {\n        id: productId,\n        name: productName,\n        price,\n        quantity,\n      },\n    ],\n  })\n}\n\n/**\n * Track checkout initiation\n */\nexport function trackPixelCheckoutStart(\n  cartValue: number,\n  items: AttributionData['items']\n): void {\n  sendPixelEvent({\n    event: 'begin_checkout',\n    value: cartValue,\n    items,\n  })\n}\n\n/**\n * Track purchase completion\n */\nexport function trackPixelPurchase(\n  orderId: string,\n  value: number,\n  currency: string,\n  items: AttributionData['items']\n): void {\n  sendPixelEvent({\n    event: 'purchase',\n    orderId,\n    value,\n    currency,\n    items,\n  })\n}\n\n/**\n * Track custom event\n */\nexport function trackPixelCustomEvent(\n  eventName: string,\n  data?: Record<string, unknown>\n): void {\n  sendPixelEvent({\n    event: eventName,\n    metadata: data,\n  })\n}\n\n/**\n * Send pixel event to platform\n */\nfunction sendPixelEvent(data: AttributionData): void {\n  if (typeof window === 'undefined' || !pixelConfig) return\n\n  // Use sendBeacon for reliable delivery\n  const payload = JSON.stringify({\n    ...data,\n    brandId: pixelConfig.brandId,\n    timestamp: Date.now(),\n    sessionId: getSessionId(),\n    url: window.location.href,\n    userAgent: navigator.userAgent,\n  })\n\n  const endpoint = `${pixelConfig.platformUrl}/api/pixel/track`\n\n  if (navigator.sendBeacon) {\n    navigator.sendBeacon(endpoint, payload)\n  } else {\n    fetch(endpoint, {\n      method: 'POST',\n      body: payload,\n      headers: { 'Content-Type': 'application/json' },\n      keepalive: true,\n    }).catch(() => {})\n  }\n}\n\n/**\n * Get or create session ID\n */\nfunction getSessionId(): string {\n  if (typeof window === 'undefined') return ''\n\n  const key = 'adsurf_session_id'\n  let sessionId = sessionStorage.getItem(key)\n\n  if (!sessionId) {\n    sessionId = `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`\n    sessionStorage.setItem(key, sessionId)\n  }\n\n  return sessionId\n}\n"],"mappings":"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","names":[]}