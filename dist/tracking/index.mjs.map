{"version":3,"sources":["../../src/tracking/analytics.ts"],"sourcesContent":["/**\n * Analytics and tracking utilities\n *\n * Supports GA4, Meta Pixel, and Microsoft Clarity\n */\n\ndeclare global {\n  interface Window {\n    gtag?: (...args: unknown[]) => void\n    fbq?: (...args: unknown[]) => void\n    clarity?: (...args: unknown[]) => void\n  }\n}\n\nexport interface AnalyticsConfig {\n  ga4Id?: string\n  metaPixelId?: string\n  clarityId?: string\n}\n\nexport interface EcommerceItem {\n  item_id: string\n  item_name: string\n  item_brand?: string\n  item_category?: string\n  item_variant?: string\n  price: number\n  quantity: number\n}\n\n/**\n * Initialize analytics scripts\n */\nexport function initializeAnalytics(config: AnalyticsConfig): void {\n  if (typeof window === 'undefined') return\n\n  // GA4\n  if (config.ga4Id && !window.gtag) {\n    const script = document.createElement('script')\n    script.src = `https://www.googletagmanager.com/gtag/js?id=${config.ga4Id}`\n    script.async = true\n    document.head.appendChild(script)\n\n    window.gtag = function () {\n      // eslint-disable-next-line prefer-rest-params\n      ;(window as { dataLayer?: unknown[] }).dataLayer =\n        (window as { dataLayer?: unknown[] }).dataLayer || []\n      // eslint-disable-next-line prefer-rest-params\n      ;(window as { dataLayer?: unknown[] }).dataLayer!.push(arguments)\n    }\n    window.gtag('js', new Date())\n    window.gtag('config', config.ga4Id)\n  }\n\n  // Meta Pixel\n  if (config.metaPixelId && !window.fbq) {\n    const script = document.createElement('script')\n    script.innerHTML = `\n      !function(f,b,e,v,n,t,s)\n      {if(f.fbq)return;n=f.fbq=function(){n.callMethod?\n      n.callMethod.apply(n,arguments):n.queue.push(arguments)};\n      if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';\n      n.queue=[];t=b.createElement(e);t.async=!0;\n      t.src=v;s=b.getElementsByTagName(e)[0];\n      s.parentNode.insertBefore(t,s)}(window, document,'script',\n      'https://connect.facebook.net/en_US/fbevents.js');\n      fbq('init', '${config.metaPixelId}');\n      fbq('track', 'PageView');\n    `\n    document.head.appendChild(script)\n  }\n\n  // Microsoft Clarity\n  if (config.clarityId && !window.clarity) {\n    const script = document.createElement('script')\n    script.innerHTML = `\n      (function(c,l,a,r,i,t,y){\n        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};\n        t=l.createElement(r);t.async=1;t.src=\"https://www.clarity.ms/tag/\"+i;\n        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);\n      })(window, document, \"clarity\", \"script\", \"${config.clarityId}\");\n    `\n    document.head.appendChild(script)\n  }\n}\n\n/**\n * Track page view\n */\nexport function trackPageView(pagePath: string, pageTitle?: string): void {\n  if (typeof window === 'undefined') return\n\n  // GA4\n  window.gtag?.('event', 'page_view', {\n    page_path: pagePath,\n    page_title: pageTitle,\n  })\n\n  // Meta Pixel\n  window.fbq?.('track', 'PageView')\n}\n\n/**\n * Track product view\n */\nexport function trackViewItem(item: EcommerceItem): void {\n  if (typeof window === 'undefined') return\n\n  // GA4\n  window.gtag?.('event', 'view_item', {\n    currency: 'USD',\n    value: item.price,\n    items: [item],\n  })\n\n  // Meta Pixel\n  window.fbq?.('track', 'ViewContent', {\n    content_ids: [item.item_id],\n    content_name: item.item_name,\n    content_type: 'product',\n    value: item.price,\n    currency: 'USD',\n  })\n}\n\n/**\n * Track add to cart\n */\nexport function trackAddToCart(item: EcommerceItem): void {\n  if (typeof window === 'undefined') return\n\n  // GA4\n  window.gtag?.('event', 'add_to_cart', {\n    currency: 'USD',\n    value: item.price * item.quantity,\n    items: [item],\n  })\n\n  // Meta Pixel\n  window.fbq?.('track', 'AddToCart', {\n    content_ids: [item.item_id],\n    content_name: item.item_name,\n    content_type: 'product',\n    value: item.price * item.quantity,\n    currency: 'USD',\n  })\n}\n\n/**\n * Track remove from cart\n */\nexport function trackRemoveFromCart(item: EcommerceItem): void {\n  if (typeof window === 'undefined') return\n\n  // GA4\n  window.gtag?.('event', 'remove_from_cart', {\n    currency: 'USD',\n    value: item.price * item.quantity,\n    items: [item],\n  })\n}\n\n/**\n * Track begin checkout\n */\nexport function trackBeginCheckout(items: EcommerceItem[], value: number): void {\n  if (typeof window === 'undefined') return\n\n  // GA4\n  window.gtag?.('event', 'begin_checkout', {\n    currency: 'USD',\n    value,\n    items,\n  })\n\n  // Meta Pixel\n  window.fbq?.('track', 'InitiateCheckout', {\n    content_ids: items.map((i) => i.item_id),\n    num_items: items.reduce((sum, i) => sum + i.quantity, 0),\n    value,\n    currency: 'USD',\n  })\n}\n\n/**\n * Track purchase\n */\nexport function trackPurchase(\n  transactionId: string,\n  items: EcommerceItem[],\n  value: number\n): void {\n  if (typeof window === 'undefined') return\n\n  // GA4\n  window.gtag?.('event', 'purchase', {\n    transaction_id: transactionId,\n    currency: 'USD',\n    value,\n    items,\n  })\n\n  // Meta Pixel\n  window.fbq?.('track', 'Purchase', {\n    content_ids: items.map((i) => i.item_id),\n    content_type: 'product',\n    num_items: items.reduce((sum, i) => sum + i.quantity, 0),\n    value,\n    currency: 'USD',\n  })\n}\n\n/**\n * Track custom event\n */\nexport function trackEvent(\n  eventName: string,\n  params?: Record<string, unknown>\n): void {\n  if (typeof window === 'undefined') return\n\n  // GA4\n  window.gtag?.('event', eventName, params)\n}\n"],"mappings":"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","names":[]}